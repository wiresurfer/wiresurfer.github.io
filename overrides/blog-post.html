<!--
  Custom blog post template with Substack-style header and footer
  Extends Material's blog-post.html structure
-->

{% extends "main.html" %}

{% import "partials/nav-item.html" as item with context %}

<!-- Page content -->
{% block container %}
  <div class="md-content md-content--post" data-md-component="content">

    <!-- Left Sidebar - Custom Design -->
    <div
      class="md-sidebar md-sidebar--post"
      data-md-component="sidebar"
      data-md-type="navigation"
    >
      <div class="md-sidebar__scrollwrap">
        <div class="md-sidebar__inner md-post">

          <!-- Back to Index -->
          <a href="{{ page.parent.url | url }}" class="sidebar-back-link">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M19 12H5M12 19l-7-7 7-7"/>
            </svg>
            <span>Back to Index</span>
          </a>

          <hr class="sidebar-divider">

          <!-- Author Card - Grid layout -->
          <div class="sidebar-author-card">
            {% if page.authors %}
              <div class="author-photo-col">
                <img src="{{ page.authors[0].avatar | url }}" alt="{{ page.authors[0].name }}" class="sidebar-author-img">
              </div>
              <div class="author-info-col">
                <div class="author-name-row">
                  {% if page.authors[0].url %}
                    <a href="{{ page.authors[0].url | url }}">{{ page.authors[0].name }}</a>
                  {% else %}
                    {{ page.authors[0].name }}
                  {% endif %}
                </div>
                <div class="author-about-row">{{ page.authors[0].description }}</div>
              </div>
            {% else %}
              <div class="author-photo-col">
                <img src="/assets/images/twitter-avatar.jpg" alt="Shaishav Kr" class="sidebar-author-img">
              </div>
              <div class="author-info-col">
                <div class="author-name-row"><a href="https://x.com/wiresurfer">Shaishav Kr</a></div>
                <div class="author-about-row">Engineering & Tech</div>
              </div>
            {% endif %}
          </div>

          <hr class="sidebar-divider">

          <!-- Metadata (no label) -->
          <div class="sidebar-metadata">
            <div class="meta-row">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="4" width="18" height="18" rx="2"/>
                <line x1="16" y1="2" x2="16" y2="6"/>
                <line x1="8" y1="2" x2="8" y2="6"/>
                <line x1="3" y1="10" x2="21" y2="10"/>
              </svg>
              <time datetime="{{ page.config.date.created }}">{{ page.config.date.created | date }}</time>
            </div>
            {% if page.categories %}
            <div class="meta-row">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/>
                <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/>
              </svg>
              <span>
                {% for category in page.categories %}
                  <a href="{{ category.url | url }}">{{ category.title }}</a>{% if not loop.last %}, {% endif %}
                {% endfor %}
              </span>
            </div>
            {% endif %}
            {% if page.config.readtime %}
            <div class="meta-row">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
                <polyline points="12 6 12 12 16 14"/>
              </svg>
              {% set time = page.config.readtime %}
              <span>{% if time == 1 %}{{ lang.t("readtime.one") }}{% else %}{{ lang.t("readtime.other") | replace("#", time) }}{% endif %}</span>
            </div>
            {% endif %}
          </div>

          <hr class="sidebar-divider">

          <!-- Tags Section -->
          {% if page.meta.tags %}
          <div class="sidebar-section">
            <div class="sidebar-section-title">Tags</div>
            <div class="sidebar-tags">
              {% for tag in page.meta.tags %}
                <a href="{{ ('/tags/#' ~ tag | replace('/', '')) | url }}" class="tag-pill tag-{{ loop.index0 % 10 }}">
                  {{ tag | replace('topic/', '') | replace('-', ' ') | title }}
                </a>
              {% endfor %}
            </div>
          </div>
          {% endif %}

          <!-- Share Section -->
          <div class="sidebar-section">
            <div class="sidebar-section-title">Share</div>
            <div class="sidebar-share-icons">
              <button class="share-icon-btn" onclick="navigator.clipboard.writeText(window.location.href).then(() => { this.classList.add('copied'); setTimeout(() => this.classList.remove('copied'), 2000); })" title="Copy link">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
                </svg>
              </button>
              <a href="https://twitter.com/intent/tweet?url={{ page.canonical_url }}&text={{ page.title | urlencode }}" target="_blank" rel="noopener" class="share-icon-btn" title="Share on X (Twitter)">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                </svg>
              </a>
              <button class="share-icon-btn" onclick="navigator.share ? navigator.share({title: '{{ page.title }}', url: window.location.href}) : alert('Share not supported')" title="Share">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92s2.92-1.31 2.92-2.92-1.31-2.92-2.92-2.92z"/>
                </svg>
              </button>
              <a href="https://www.linkedin.com/sharing/share-offsite/?url={{ page.canonical_url }}" target="_blank" rel="noopener" class="share-icon-btn" title="Share on LinkedIn">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 01-2.063-2.065 2.064 2.064 0 112.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
                </svg>
              </a>
            </div>
          </div>

          <!-- Related links -->
          {% if page.config.links %}
            <hr class="sidebar-divider">
            <div class="sidebar-section">
              <div class="sidebar-section-title">{{ lang.t("blog.references") }}</div>
              <nav class="md-nav">
                <ul class="md-nav__list">
                  {% for nav_item in page.config.links %}
                    {% set path = "__ref_" ~ loop.index %}
                    {{ item.render(nav_item, path, 1) }}
                  {% endfor %}
                </ul>
              </nav>
            </div>
          {% endif %}

          <!-- Table of contents, if integrated -->
          {% if "toc.integrate" in features %}
            <hr class="sidebar-divider">
            {% include "partials/toc.html" %}
          {% endif %}
        </div>
      </div>
    </div>

    <!-- Page content with Substack-style header and footer -->
    <article class="md-content__inner md-typeset">

      <!-- Substack-style Header -->
      <header class="substack-header">
        <!-- Category badge -->
        {% if page.categories %}
          <a href="{{ page.categories[0].url | url }}" class="post-category-badge">
            {{ page.categories[0].title }}
          </a>
        {% endif %}

        <!-- Title -->
        <h1 class="post-title-hero">{{ page.title }}</h1>

        <!-- Subtitle (optional) -->
        {% if page.meta.subtitle %}
          <p class="post-subtitle">{{ page.meta.subtitle }}</p>
        {% endif %}

        <!-- Tags in header -->
        {% if page.meta.tags %}
        <div class="header-tags">
          {% for tag in page.meta.tags %}
            <a href="{{ ('/tags/#' ~ tag | replace('/', '')) | url }}" class="header-tag tag-{{ loop.index0 % 10 }}">
              {{ tag | replace('topic/', '') | replace('-', ' ') | title }}
            </a>
          {% endfor %}
        </div>
        {% endif %}

        <!-- Author meta -->
        <div class="post-author-meta">
          {% if page.authors %}
            <img src="{{ page.authors[0].avatar | url }}" class="author-avatar-large" alt="{{ page.authors[0].name }}">
            <div class="author-info">
              <a href="{{ page.authors[0].url }}" class="author-name">
                {{ page.authors[0].name }}
              </a>
              <div class="post-meta-line">
                <time datetime="{{ page.config.date.created }}">{{ page.config.date.created | date }}</time>
                {% if page.config.readtime %}
                  <span class="meta-separator">·</span>
                  {% set time = page.config.readtime %}
                  <span class="read-time">{% if time == 1 %}{{ lang.t("readtime.one") }}{% else %}{{ lang.t("readtime.other") | replace("#", time) }}{% endif %}</span>
                {% endif %}
              </div>
            </div>
          {% else %}
            <img src="/assets/images/twitter-avatar.jpg" class="author-avatar-large" alt="Shaishav Kr">
            <div class="author-info">
              <a href="https://x.com/wiresurfer" class="author-name">Shaishav Kr</a>
              <div class="post-meta-line">
                <time datetime="{{ page.config.date.created }}">{{ page.config.date.created | date }}</time>
                {% if page.config.readtime %}
                  <span class="meta-separator">·</span>
                  {% set time = page.config.readtime %}
                  <span class="read-time">{% if time == 1 %}{{ lang.t("readtime.one") }}{% else %}{{ lang.t("readtime.other") | replace("#", time) }}{% endif %}</span>
                {% endif %}
              </div>
            </div>
          {% endif %}
        </div>
      </header>

      <!-- Main Content -->
      {% block content %}
        {% include "partials/content.html" %}
      {% endblock %}

      <!-- Post Footer -->
      <footer class="post-footer">
        <!-- Author Section -->
        <div class="post-author-section">
          {% if page.authors %}
            <div class="author-photo-container">
              <img src="{{ page.authors[0].avatar | url }}" class="author-photo-round" alt="{{ page.authors[0].name }}">
            </div>
            <div class="author-about">
              <h4>About {{ page.authors[0].name }}</h4>
              <p>{{ page.authors[0].description }}</p>
              {% if page.authors[0].url %}
                <a href="{{ page.authors[0].url }}" class="author-link">Follow @{{ page.authors[0].slug or page.authors[0].name | lower | replace(' ', '') }}</a>
              {% endif %}
            </div>
          {% else %}
            <div class="author-photo-container">
              <img src="/assets/images/twitter-avatar.jpg" class="author-photo-round" alt="Shaishav Kr">
            </div>
            <div class="author-about">
              <h4>About Shaishav Kr</h4>
              <p>Engineering leader and technology enthusiast. Writing about software architecture, platform engineering, and the future of tech.</p>
              <a href="https://x.com/wiresurfer" class="author-link">Follow @wiresurfer</a>
            </div>
          {% endif %}
        </div>

        <!-- CTA Section -->
        {% include "partials/convertkit.html" %}
      </footer>

    </article>
  </div>
{% endblock %}
